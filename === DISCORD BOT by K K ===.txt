// === DISCORD BOT by K K ===
// A smart, fun, and safe Discord bot ğŸ˜

const { Client, GatewayIntentBits, Partials } = require("discord.js");
const axios = require("axios");

const client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.GuildMembers,
    GatewayIntentBits.MessageContent,
  ],
  partials: [Partials.Channel],
});

const DISCORD_TOKEN = "Brick";
const OPENROUTER_KEY = "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";
const ADMIN_ID = "Cookie3343";

// âœ… 1. When bot starts
client.once("ready", () => {
  console.log(`ğŸ¤– Logged in as ${client.user.tag}`);
  client.user.setActivity("Chatting & Games ğŸ®");
});

// ğŸ‘‹ 2. Welcome new members
client.on("guildMemberAdd", member => {
  const channel = member.guild.systemChannel;
  if (!channel) return;
  channel.send(`Welcome to the server, ${member}! ğŸ‰\nIâ€™m your friendly assistant â€” type \`!help\` to see what I can do!`);
});

// ğŸ§  3. Chat system using AI (via OpenRouter API)
client.on("messageCreate", async msg => {
  if (msg.author.bot) return;

  const text = msg.content.toLowerCase();

  // ğŸ§¹ 4. Check for bad language
  const badWords = ["fuck", "bitch", "asshole", "slut", "nigger", "cunt", "dick"];
  if (badWords.some(w => text.includes(w))) {
    await msg.delete().catch(() => {});
    const admin = await client.users.fetch(ADMIN_ID);
    if (admin) {
      admin.send(`âš ï¸ Abusive message deleted from ${msg.author.tag}:\n"${msg.content}" in #${msg.channel.name}`);
    }
    return;
  }

  // ğŸ® 5. Fun Commands
  if (text === "!help") {
    msg.reply(
      "**Hereâ€™s what I can do:**\n" +
      "ğŸ—£ï¸ Chat about anything â€” just mention me or type `!chat <message>`\n" +
      "ğŸ¯ Play `!luckdraw`\n" +
      "ğŸ˜‚ Tell a joke with `!joke`\n" +
      "ğŸš¨ Keeps chat clean & reports bad words\n"
    );
    return;
  }

  if (text === "!joke") {
    const jokes = [
      "Why did the scarecrow win an award? Because he was outstanding in his field! ğŸŒ¾",
      "I tried to catch fog yesterday â€” Mist! ğŸ˜†",
      "Why donâ€™t skeletons fight each other? They donâ€™t have the guts ğŸ’€",
      "I told my computer I needed a break, and it froze ğŸ§Š"
    ];
    msg.reply(jokes[Math.floor(Math.random() * jokes.length)]);
    return;
  }

  if (text === "!luckdraw") {
    const prizes = ["ğŸ Nitro Gift", "ğŸ’° 10,000 coins", "ğŸª Cookie", "ğŸ® Game night ticket", "ğŸ‘» Nothing... try again!"];
    const winner = prizes[Math.floor(Math.random() * prizes.length)];
    msg.reply(`Spinning the wheel... ğŸ¡ You got **${winner}**!`);
    return;
  }

  // ğŸ—£ï¸ 6. AI chat feature
  if (msg.mentions.has(client.user) || text.startsWith("!chat")) {
    const userMessage = msg.content.replace(/<@!?(\d+)>/, "").replace("!chat", "").trim();
    if (!userMessage) return msg.reply("What do you wanna talk about? ğŸ˜„");

    msg.channel.sendTyping();

    try {
      const res = await axios.post(
        "https://openrouter.ai/api/v1/chat/completions",
        {
          model: "meta-llama/llama-3-8b-instruct",
          messages: [
            {
              role: "system",
              content:
                "You are a friendly Discord bot who loves chatting about everything â€” F1, anime, food, games, and life. Keep responses casual, funny, and respectful.",
            },
            { role: "user", content: userMessage },
          ],
        },
        {
          headers: {
            Authorization: `Bearer ${OPENROUTER_KEY}`,
            "Content-Type": "application/json",
          },
        }
      );

      const reply = res.data.choices[0].message.content;
      msg.reply(reply);
    } catch (err) {
      console.error("AI error:", err.response?.data || err.message);
      msg.reply("My brainâ€™s tired ğŸ’¤ â€” try again later!");
    }
  }
});

client.login(DISCORD_TOKEN);


